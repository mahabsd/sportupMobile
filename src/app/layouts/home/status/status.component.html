<ion-grid >
  <ion-row lines="none">
    <ion-avatar slot="" class="ion-padding" *ngIf="isUserConnected !== post?.user?._id">
      <img [src]="apiImgUser + post?.user?.photo" (click)="getfollow(post?.user?._id)" />
    </ion-avatar>
    <ion-label (click)="getfollow(post?.user?._id)" class="ion-justify-content-center"
      *ngIf="isUserConnected !== post?.user?._id" style="display: grid; align-self: center">
      <h3 class="
          ion-text-capitalize
          ion-align-self-start
          ion-justify-content-start
          ion-text-start
        " routerLinkActive="router-link-active">
        {{ post?.user?.name }}
      </h3>
      <p>{{ post?.createdAt | date }}</p>
    </ion-label>

    <ion-avatar slot="" class="ion-padding" *ngIf="isUserConnected === post?.user?._id">
      <img [src]="apiImgUser + post?.user?.photo" routerLink="/menu/tabs/layouts/coachprofile/{{ post.user.id }}/me" />
    </ion-avatar>

    <ion-label [routerLink]="['/menu/tabs/layouts/coachprofile/{{ post.user.id }}/me/coachphoto']" class="ion-justify-content-center"
      *ngIf="isUserConnected === post?.user?._id" style="display: grid; align-self: center">
      <h3 class="
          ion-text-capitalize
          ion-align-self-start
          ion-justify-content-start
          ion-text-start
        " routerLinkActive="router-link-active">
        {{ post?.user?.name }}
      </h3>
      <p>{{ post?.createdAt | date }}</p>
    </ion-label>

    <ion-button color="light" slot="end" shape="round" fill="clear" size="small" (click)="presentPopover($event)">
      <ion-icon color="light" style="color: #fff" slot="icon-only" name="ellipsis-vertical">
      </ion-icon>
    </ion-button>
  </ion-row>
  <ion-row lines="none" class="ion-justify-content-center ion-margin" *ngIf="images.length > 0">
    <img [lazyLoad]="apiImg + images[0]?.image_name" />
  </ion-row>
  <div (click)="displayContent(post)" *ngIf="mediafiles.length === 0">
    <span style="display:flex;padding-left:20px">{{post.content}}</span>
    <div style="display: flex; justify-content: center;flex-direction:column">
      <div *ngFor="let file of newMediaFiles">
        <ng-container *ngIf="getExt(file.file_name) === 'png'">
          <div
            style="width: 350px; height: 220px"
            id="first"
            [style.background-size]="'cover'"
            [style.background-image]="'url(' + apiImg + file?.file_name + ')'"

            errorImage="../../../assets/imgs/150.png"

          >
            <ion-icon></ion-icon>
          </div>
        </ng-container>
        <ng-container *ngIf="getExt(file.file_name) === 'mp4'">
          <div
            style="
              margin-left: 15px;
              width: 350px;
              height: 220px;
              display: flex;
              justify-content: center;
              align-items: center;
              border-radius: 10px;
            "
            [style.background-size]="'cover'"
            [style.background-image]="'url(../../../assets/imgs/150.png)'"
            errorImage="../../../assets/imgs/150.png"
            (click)="displayVideo(file)"
          >
            <ion-icon
              style="height: 50px; width: 50px"
              name="videocam"
            ></ion-icon>
          </div>
        </ng-container>
      </div>
    </div>

  </div>
  <div
  (click)="displayContent(post)"
    *ngIf="
      newMediaFiles.length > 0 &&
      thirdNewMediaFiles.length === 0 &&
      mediafiles.length !== 0
    "
  >
    <div style="display: flex; justify-content: center">
      <div *ngFor="let file of newMediaFiles">
        <ng-container *ngIf="getExt(file.file_name) === 'png'">
          <div style="width: 250px" id="first" [style.background-size]="'cover'"
            [style.background-image]="'url(' + apiImg + file?.file_name + ')'"
            errorImage="../../../assets/imgs/150.png" >
            <ion-icon></ion-icon>
          </div>
        </ng-container>
        <ng-container *ngIf="getExt(file.file_name) === 'mp4'">
          <div style="
              margin-left: 15px;
              width: 250px;
              height: 200px;
              display: flex;
              justify-content: center;
              align-items: center;
              border-radius: 10px;
            " [style.background-size]="'cover'" [style.background-image]="'url(../../../assets/imgs/150.png)'"
            errorImage="../../../assets/imgs/150.png" (click)="displayVideo(file)">
            <ion-icon style="height: 50px; width: 50px" name="videocam"></ion-icon>
          </div>
        </ng-container>
      </div>
      <div class="nextContainer" (click)="displayContent(post)">
        <div *ngFor="let file of mediafiles">
          <ng-container *ngIf="getExt(file.file_name) === 'png'">
            <div id="next" [style.background-size]="'cover'"
              [style.background-image]="'url(' + apiImg + file?.file_name + ')'"
              errorImage="../../../assets/imgs/150.png"  >
              <ion-icon></ion-icon>
            </div>
          </ng-container>
          <ng-container *ngIf="getExt(file.file_name) === 'mp4'">
            <div
              style="
                margin-left: 15px;
                width: 50px;
                height: 50px;
                display: flex;
                justify-content: center;
                align-items: center;
                border-radius: 10px;
              "
              [style.background-size]="'cover'"
              [style.background-image]="'url(../../../assets/imgs/150.png)'"
              errorImage="../../../assets/imgs/150.png"
              (click)="displayVideo(mediafiles)"
            >
              <ion-icon name="videocam"></ion-icon>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="secondNewMediaFiles.length !== 0" (click)="displayContent(post)">
    <div style="display: flex">
      <div *ngFor="let file of newMediaFiles">
        <ng-container *ngIf="getExt(file.file_name) === 'png'">
          <div id="first" [style.background-size]="'cover'"
            [style.background-image]="'url(' + apiImg + file?.file_name + ')'"
            errorImage="../../../assets/imgs/150.png"  >
            <ion-icon></ion-icon>
          </div>
        </ng-container>
        <ng-container *ngIf="getExt(file.file_name) === 'mp4'">
          <div style="
              margin-left: 15px;
              width: 250px;
              height: 200px;
              display: flex;
              justify-content: center;
              align-items: center;
              border-radius: 10px;
            " [style.background-size]="'cover'" [style.background-image]="'url(../../../assets/imgs/150.png)'"
            errorImage="../../../assets/imgs/150.png" (click)="displayVideo(file)">
            <ion-icon style="height: 50px; width: 50px" name="videocam"></ion-icon>
          </div>
        </ng-container>
      </div>
      <div class="nextContainer" style="position: relative">
        <div *ngFor="let file of thirdNewMediaFiles" >
          <ng-container *ngIf="getExt(file.file_name) === 'png'">
            <div id="next" [style.background-size]="'cover'"
              [style.background-image]="'url(' + apiImg + file?.file_name + ')'"
              errorImage="../../../assets/imgs/150.png"  >
              <ion-icon></ion-icon>
            </div>
          </ng-container>
          <!-- <p style="color: black">{{ secondNewMediaFiles.lenght }}</p> -->
          <ng-container *ngIf="getExt(file.file_name) === 'mp4'">
            <div [style.background-size]="'cover'" [style.background-image]="'url(../../../assets/imgs/150.png)'"
              errorImage="../../../assets/imgs/150.png" (click)="displayVideo(file)">
              <ion-icon name="videocam"></ion-icon>
            </div>
          </ng-container>
        </div>
        <div   style="
            position: absolute;
            background-color: rgba(0, 0, 0, 0.219);
            color: rgb(255, 255, 255);
            font-size: 20px;
            bottom: 0;
            left: 0;
            width: 95px;
            height: 95px;
            border-radius: 5px;
            margin: 1px 0 0 1px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
          ">
          + {{ this.secondNewMediaFiles.length }}
        </div>
      </div>
    </div>
  </div>
</ion-grid>

  <ion-row style="margin: 0;margin-top:-12px" lines="none">
    <ion-col size="col-2">
      <ion-chip>
        <ng-container *ngIf="!post?.likedBy.includes(user?._id); else dislikedTemp">
          <ion-button style="display: flex;align-items:center" (dblclick)="showReactions($event)" (click)="like(post, $event.target)" shape="round" fill="clear"
            size="large">
            <img src="../../../../assets/iconPost/{{ post?.iconLike }}.svg" class="iconstyle" id="icon_liked" />
            <span style="color:#7F867D;font-size:14px">{{ post?.likes }} </span>
          </ion-button>
        </ng-container>
        <ng-template #dislikedTemp>
          <ion-button style="display: flex;align-items:center" (dblclick)="showReactions($event)" (click)="disLike(post, $event.target)" shape="round"
            fill="clear" size="large">
            <img src="../../../../assets/iconPost/{{ post?.iconLike }}.svg" id="icon_like" />
            <span style="color:#7F867D;font-size:14px">{{ post?.likes }} </span>
          </ion-button>
        </ng-template>
      </ion-chip>
    </ion-col>
    <ion-col style="text-align: end">
      <ion-chip>
        <ion-button style="display: flex;align-items:center" (click)="presentModal(post)" shape="round" fill="clear" size="large">
          <img class="iconstyle" src="../../../../assets/iconPost/icon_comment.svg" />
          <span style="color:#7F867D;font-size:14px">{{ comments?.length }}</span>
        </ion-button>
        <ng-container *ngIf="!bookmarked; else unbook">
          <ion-button style="display: flex;align-items:center" (click)="bookmark(post)" shape="round" fill="clear" size="large ">
            <img class="iconstyle" src="../../../../assets/iconPost/icon_bookmark.svg" />
            <span style="color:#7F867D;font-size:14px">{{ post?.favorisNb }}</span>
          </ion-button>
        </ng-container>
        <ng-template #unbook>
          <ion-button style="display: flex;align-items:center" (click)="unBookmark(post)" shape="round" fill="clear" size="large ">
            <img class="iconstyle" src="../../../../assets/iconPost/icon_bookmarked.svg" />
            <span style="color:#7F867D;font-size:14px">{{ post?.favorisNb }}</span>
          </ion-button>
        </ng-template>
        <ion-button style="display: flex;align-items:center" (click)="share(post)" shape="round" fill="clear" size="large ">
          <img class="iconstyle" src="../../../../assets/iconPost/icon_share.svg" />
          <span style="color:#7F867D;font-size:14px">{{ post?.sharedeNb }}</span>
        </ion-button>
      </ion-chip>
    </ion-col>
    <div style="width: 100%;">
      <div style="display: flex;align-items:center">
        <ng-container *ngIf="showComment===false; else not" >
          <ng-container *ngIf="comments.length!==0"  style="position: relative;">
            <p (click)="showComments()" style="display:flex;align-items:center;font-size:12px;position:absolute;right:20px;color:#7F867D;transform:translateY(-30px)">Afficher plus de commentaires <ion-icon name="chevron-forward-outline"></ion-icon></p>
          </ng-container>
          <ng-container *ngIf="comments.length!==0" >
            <div style="display: flex;align-items:center;padding-top:15px" >
              <div style="display: flex;flex-direction:column;align-items:center">
                <img style="width: 22px; height:22px;border-radius:50%;object-fit:cover" src={{apiImgUser+comments[0].user.photo}} alt="">
                <span style="font-size: 12px;">{{comments[0].user.name}}</span>
              </div>
              <span style="background-color:#EEEFEF ;margin:2px;padding:7px 10px;width:220px;height:30px;border-radius:15px;text-align:start;text-overflow:ellipsis;overflow:hidden;white-space: nowrap;font-size:12px">{{comments[0].content}}</span>
            </div>
          </ng-container>
        </ng-container>
        <ng-template #not>
          <p (click)="hideComments()" style="display:flex;align-items:center;font-size:12px;position:absolute;right:20px;color:#7F867D">Afficher moins de commentaires <ion-icon name="chevron-down-outline"></ion-icon></p>

        </ng-template>
      </div>
      <div style="margin-top: 10px;">
        <ng-container *ngIf="showComment===true">
          <div style="display: flex;align-items:center;margin:3px 0" *ngFor="let item of comments.slice().reverse()" >
            <div style="display: flex;flex-direction:column;align-items:center">
              <img style="width: 22px; height:22px;border-radius:50%;object-fit:cover" src={{apiImgUser+item.user.photo}} alt="">
              <span style="font-size: 12px;">{{item.user.name}}</span>
            </div>
            <span style="background-color:#EEEFEF ;margin:2px;padding:7px 10px;width:220px;height:30px;border-radius:15px;text-align:start;text-overflow:ellipsis;overflow:hidden;white-space: nowrap;font-size:12px">{{item.content}}</span>
          </div>
        </ng-container>
      </div>
      <div style="display: flex;justify-content:space-between;align-items:center; background-color:#EEEFEF; border-radius:10px;margin:10px 0 20px 0">
        <div style="display: flex;align-items:center;padding:0px 10px">
          <img style="width: 30px; height:30px;border-radius:50%;object-fit:cover"  src={{apiImgUser+user.photo}} routerLink="/menu/tabs/layouts/coachprofile/{{ post.user.id }}/me" />
          <input placeholder="Ecrivez un commentaire ..." style="margin-left:5px;font-size:15px;border: none; background-color:#EEEFEF;margin-right:10px;padding:10px" type="text">
        </div>
        <div style="display: flex;">
          <img style="width: 20px;height:20px;margin-right:5px" src="../../../assets/svg/pics.svg" alt="">
          <img style="width: 20px;height:20px;margin-right:5px" src="../../../assets/svg/camera.svg" alt="">
          <img style="width: 20px;height:20px;margin-right:5px" src="../../../assets/svg/gif.svg" alt="">
          <img style="width: 20px;height:20px;margin-right:5px" src="../../../assets/svg/attach.svg" alt="">
          <img style="width: 20px;height:20px;margin-right:5px" src="../../../assets/svg/mic.svg" alt="">
        </div>
      </div>
    </div>
  </ion-row>
